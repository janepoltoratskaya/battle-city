function u(){function p(){q();d.fillStyle="#000000";d.beginPath();d.fillRect(0,0,l,k);d.fill();for(var h=0;10>h;h++)for(var a=0;13>a;a++)if(0!=r[h][a]){var c=new Image;c.src=r[h][a];d.drawImage(c,64*a,64*h)}d.beginPath();for(var b in e)d.rect(e[b].x,e[b].y,e[b].g,e[b].h),d.fillStyle="#000000",d.fill();j.j();for(var v in m)m[v].j();setTimeout(p,20)}function q(){for(;4>m.length;){var d=new s;d.l("e","d",0,0);m.push(d)}}function s(){function h(a){for(var b=0;b<a.data.length;b+=4)if(!(0==a.data[b]&&a.data[b]==
a.data[b+1]&&a.data[b+1]==a.data[b+2]))return!1;return!0}var a=this;a.k=new Image;a.l=function(c,b,d,f){a.k.src=c;a.d=d;a.e=f;a.f=b;a.i=0;a.a=[];a.type=c};a.move=function(c){if(0<=a.d&&a.d+64<=l&&0<=a.e&&a.e+64<=k){var b,e,f=a.d,g=a.e;a.f=c||a.f;switch(a.f){case "u":e=0;g-=4;b=d.getImageData(f,g,64,1);break;case "d":e=Math.PI;g+=4;b=d.getImageData(f,g+64,64,1);break;case "r":e=Math.PI/2;f+=4;b=d.getImageData(f+64,g,1,64);break;case "l":e=3*Math.PI/2,f-=4,b=d.getImageData(f,g,1,64)}h(b)&&(a.d=f,a.e=
g);a.i=e}};a.n=function(){var c={b:0,c:0,x:0,y:0};switch(a.f){case "u":c.b=1;c.c=0;break;case "d":c.b=-1;c.c=2;break;case "r":c.b=2;c.c=-1;break;case "l":c.b=0,c.c=1}c.x=a.d+32*Math.abs(c.b);2==c.b&&(c.b=0);c.y=a.e+32*Math.abs(c.c);2==c.c&&(c.c=0);a.a.push(c)};a.m=function(){if(0==a.d%8&&0==a.e%8&&0==Math.floor(Math.floor(128*Math.random()))%16){for(var c=Math.floor(4*Math.random())-1;t[c]==a.f;)c=Math.floor(4*Math.random())-1;console.log(c);a.move(t[c])}else a.move()};a.j=function(){"e"==a.type&&
a.m();d.translate(a.d+32,a.e+32);d.rotate(a.i);d.drawImage(a.k,-32,-32);d.rotate(-a.i);d.translate(-(a.d+32),-(a.e+32));if(a.a.length){var c,b;for(b in a.a)aX=Math.abs(a.a[b].b),aY=Math.abs(a.a[b].c),c=d.getImageData(a.a[b].x-32*aX-a.a[b].c,a.a[b].y-32*aY-a.a[b].b,Math.pow(64,aX),Math.pow(64,aY)),h(c)?(d.beginPath(),d.arc(a.a[b].x,a.a[b].y,4,0,2*Math.PI,!1),d.fillStyle="gray",d.fill(),a.a[b].x+=-4*a.a[b].c,a.a[b].y+=-4*a.a[b].b,(0>a.a[b].y||0>a.a[b].x||a.a[b].x>l||a.a[b].y>k)&&delete a.a[b]):(1==
a.a[b].b&&e.push({x:a.a[b].x-32,y:a.a[b].y-16,g:64,h:16}),-1==a.a[b].b&&e.push({x:a.a[b].x-32,y:a.a[b].y,g:64,h:16}),1==a.a[b].c&&e.push({x:a.a[b].x-16,y:a.a[b].y-32,g:16,h:64}),-1==a.a[b].c&&e.push({x:a.a[b].x,y:a.a[b].y-32,g:16,h:64}),delete a.a[b])}}}var n=document.getElementById("c"),d=n.getContext("2d"),l=832,k=640,m=[],r=[[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,4,0,4,0,4,0,4,0,4,0,4,0],[0,4,0,4,0,0,0,4,0,4,0,4,0],[0,0,0,0,4,4,0,4,0,0,0,0,0],[0,4,0,4,0,4,0,4,0,4,0,4,0],[0,4,0,4,0,4,0,4,0,4,0,4,0],[0,
0,0,0,0,4,0,4,0,0,0,0,0],[0,4,0,4,0,4,4,4,4,4,0,4,0],[0,4,0,4,0,4,0,4,0,4,0,4,0],[0,0,0,0,0,0,0,0,0,0,0,0,0]];n.width=l;n.height=k;var t="udrl",e=[],j=new s;j.l("p","u",384,k-64);p();q();window.addEventListener("keydown",function(d){switch(d.keyCode){case 38:j.move("u");break;case 40:j.move("d");break;case 37:j.move("l");break;case 39:j.move("r");break;case 32:j.n()}},!0)}window.addEventListener("load",function(){bm=new u});