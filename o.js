function v(){function r(){for(i in e)e[i].r();if(0<q&&0<e[0].k){c.fillStyle="#000000";c.beginPath();c.fillRect(0,0,n,p);c.fill();for(var k=0;10>k;k++)for(var a=0;13>a;a++)if(0!=s[k][a]){var b=new Image;b.src=t[s[k][a]];c.drawImage(b,64*a,64*k)}c.beginPath();for(var d in h)c.rect(h[d].x,h[d].y,h[d].h,h[d].i),c.fillStyle="#000000",c.fill();for(i in e)e[i].s();setTimeout(r,20)}else 0>=e[0].k&&alert("you lose!"),0>=q&&alert("you win!")}function w(){function k(a){for(var d=0;d<a.data.length;d+=4)if(!(0==
a.data[d]&&a.data[d]==a.data[d+1]&&a.data[d+1]==a.data[d+2]))return!1;return!0}var a=this;a.m=new Image;a.k=3;a.n=function(b,d,z,c,e){a.m.src=t[b];a.d=z;a.f=c;a.g=d;a.j=0;a.a=[];a.type=b;a.t=e};a.move=function(b){if(0<=a.d&&a.d+64<=n&&0<=a.f&&a.f+64<=p){var d,e,f=a.d,g=a.f;a.g=b||a.g;switch(a.g){case "u":e=0;0<=g-4&&(g-=4);d=c.getImageData(f,g,64,1);break;case "d":e=Math.PI;g+68<=p&&(g+=4);d=c.getImageData(f,g+64,64,1);break;case "r":e=Math.PI/2;f+68<=n&&(f+=4);d=c.getImageData(f+64,g,1,64);break;
case "l":e=3*Math.PI/2,0<=f-4&&(f-=4),d=c.getImageData(f,g,1,64)}k(d)&&(a.d=f,a.f=g);a.j=e}};a.l=function(){var b={b:0,c:0,x:0,y:0};switch(a.g){case "u":b.b=1;b.c=0;break;case "d":b.b=-1;b.c=2;break;case "r":b.b=2;b.c=-1;break;case "l":b.b=0,b.c=1}b.x=a.d+32*Math.abs(b.b);2==b.b&&(b.b=0);b.y=a.f+32*Math.abs(b.c);2==b.c&&(b.c=0);a.a.push(b)};a.q=function(){if(0==a.d%8&&0==a.f%8&&0==Math.floor(Math.floor(128*Math.random()))%16){for(var b=Math.floor(4*Math.random())-1;u[b]==a.g;)b=Math.floor(4*Math.random())-
1;a.move(u[b])}else a.move();0==a.a.length&&a.l()};a.u=function(){var b=x,d=y,c;for(c in e)c!=a.t&&a.type!=e[c].type&&(b>=e[c].d&&b<=e[c].d+64&&d>=e[c].f&&d<=e[c].f+64)&&("p"==e[c].type?(e[c].k--,e[c].n(j[c][0],j[c][1],64*j[c][2],64*j[c][3],c)):(e.splice(c,1),q--));return!1};a.r=function(){if(a.a.length){var b,d;for(d in a.a)if(aX=Math.abs(a.a[d].b),aY=Math.abs(a.a[d].c),x=a.a[d].x,y=a.a[d].y,b=c.getImageData(x-32*aX-a.a[d].c,y-32*aY-a.a[d].b,Math.pow(64,aX),Math.pow(64,aY)),!(a.a[d].o=k(b)))a.u()||
(1==a.a[d].b&&h.push({x:x-32,y:y-16,h:64,i:16}),-1==a.a[d].b&&h.push({x:x-32,y:y,h:64,i:16}),1==a.a[d].c&&h.push({x:x-16,y:y-32,h:16,i:64}),-1==a.a[d].c&&h.push({x:x,y:y-32,h:16,i:64})),a.a.splice(d,1)}};a.s=function(){"e"==a.type&&a.q();c.translate(a.d+32,a.f+32);c.rotate(a.j);c.drawImage(a.m,-32,-32);c.rotate(-a.j);c.translate(-(a.d+32),-(a.f+32));if(a.a.length)for(var b in a.a)a.a[b].o&&(c.beginPath(),c.arc(a.a[b].x,a.a[b].y,4,0,2*Math.PI,!1),c.fillStyle="gray",c.fill(),a.a[b].x+=-4*a.a[b].c,a.a[b].y+=
-4*a.a[b].b,(0>a.a[b].y||0>a.a[b].x||a.a[b].x>n||a.a[b].y>p)&&a.a.splice(b,1))}}var m=document.getElementById("c"),c=m.getContext("2d"),n=832,p=640,e=[],s=[[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,4,0,4,0,4,0,4,0,4,0,4,0],[0,4,0,4,0,0,0,4,0,4,0,4,0],[0,0,0,0,4,4,0,4,0,0,0,0,0],[0,4,0,4,0,4,0,4,0,4,0,4,0],[0,4,0,4,0,4,0,4,0,4,0,4,0],[0,0,0,0,0,4,0,4,0,0,0,0,0],[0,4,0,4,0,4,4,4,4,4,0,4,0],[0,4,0,4,0,4,0,4,0,4,0,4,0],[0,0,0,0,0,0,0,0,0,0,0,0,0]];m.width=n;m.height=p;var t={p:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAMAAACdt4HsAAAADFBMVEUAAAD85pyEcgT8mjS3aVkRAAAAfklEQVR42u3WMQ7AIAxD0da5/51LBrBQXJ/Af6sU3kJU8fjezk4ECMARnCTgTgTYQHUc9gC62gVYAE4cJqruCFcB5iayEuFUuwBzE5UnFBbg2kQF8ER14jOA2UQPsADun8hhewsB5iaq+2CYBfh5J+Iv8UYKsIDqwBGb4AMAH8M+F62cJsO7AAAAAElFTkSuQmCC",
e:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAIAAAAlC+aJAAAACXBIWXMAAAsTAAALEwEAmpwYAAABR0lEQVRoge2aPQrCQBSEjewRLDyNpAiewcIiB7H0ICksPIOkCJ7GwiMEsQvrCIObH98+mK97ZPeF4TE7gWyxWob+1cdlWIeFXrReqO/fkABrJMAaCbDGvYDQ3tqhOJwbsvR5v5CncZ9vNrvj760gBLdlTRa7n4AEWONeQBE7pms7srTaV3EJVoO9ZVXGJTcieJqfB4D7CUiANe4FBGKv6+njEbh2RiCnAf594H4CEmCNewEJSQzhCvC9APclHB4c9xOQAGvcC0hIYoC7FmwKraDknlYS540EWBMeXTMUSWkKcKtBiie9iJ8l7icgAda4FzA+iTnx2TARJXHeSIA1syUxOH5KK94ZcD8BCbDGvYDxSTzlC5mHa9Ji9xOQAGvcC0hIYrh5mPTHKfEaSR0XSuK8kQBrxicxeJr/6wX4jS1ASZw3EmDNG5W9eJza+PrVAAAAAElFTkSuQmCC",
4:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABAAgMAAADXB5lNAAAACVBMVEW6BgCAgIDWMgC+PaXGAAAANklEQVR4nGNgAIJQBgiA0aQKrAKCUDAJoQdKIBQNkCVAYVhAGAhHgcCACVAhPEbTx2j6wCMAAKVYc/DEwHQUAAAAAElFTkSuQmCC"},u="udrl",j=[["p","u",0,9],["e","d",0,0],["e","d",12,0]],q=2,h=[],l;for(l in j)m=new w,m.n(j[l][0],j[l][1],64*j[l][2],64*j[l][3],l),e[l]=m;r();window.addEventListener("keydown",function(c){switch(c.keyCode){case 38:e[0].move("u");break;case 40:e[0].move("d");break;case 37:e[0].move("l");break;case 39:e[0].move("r");
break;case 32:e[0].l()}},!0)}window.addEventListener("load",function(){bm=new v});